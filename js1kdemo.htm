<!DOCTYPE html>
<!-- saved from url=(0035)http://js1k.com/pleaseDontHotlinkMe -->
<HTML><HEAD><META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<TITLE>JS1k, 1k demo submission [id]</TITLE>
		<META charset="utf-8">
	</HEAD><BODY>
		<CANVAS id="c"></CANVAS>
		<SCRIPT>
		  /* demo here */
			var canvas=document.getElementById("c");
            var ctx = canvas.getContext("2d");
            var level = decompress("4 5#9 5 #3 #9 5 #$2 #9 3 3#2 $2#9 2 #2 $ $ #9 3# # 2# #3 7#3 # 2# 5#2 2.2# $2 $9  2.6# 3# #@2#2 2.#4 #5 9#4 7#8 ");
            var position = level.indexOf('@');
            var lwidth = 19;
            var lheight = 11;
            var pushes = 0;
            canvas.height = canvas.width = 450;
            document.onkeydown = keyDown;
            
            setInterval(draw, 10);
           
            function draw()
            {
                var y = 0;
                ctx.textBaseline = "top";
                ctx.font = "15px monospace";

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                for (var i = 0; i < lheight; i++)
                {
                    ctx.fillText(level.substring(i * lwidth, (i * lwidth) + lwidth), 0, y);
                    y += 15;
                }
                
                //if (gameOver())
                //{
                //    alert("game over");
                //    return;
                //}
                
                //document.write("ok");
            }

            function keyDown(evt)
            {
                if (evt.keyCode==37) move((position%lwidth+1)!=2, position-1, position-2);
                if (evt.keyCode==38) move(true, position-lwidth, position - (2*lwidth));
                if (evt.keyCode==39) move(true, position+1, position+2);
                if (evt.keyCode==40) move(position<(lwidth*lheight)-lwidth+1, position+lwidth, position+(2*lwidth));
            }
            
            function gameOver()
            {
                return level.indexOf(".")==-1 && !isWarehouse();
            }
            
            function isWarehouse()
            {
                return ".%*".indexOf(level.charAt(position - 1)) > -1;
            }
            
            function getChar(position)
            {
                return level.charAt(position);
            }
            
            function setChar(item, pos)
            {
                level = level.substring(0, pos) + item + level.substring(pos + 1);
            }
            
            function move(limit, nextPosition, otherPosition)
            {
                var p = getChar(position);
                var np = getChar(nextPosition);
                var op = getChar(otherPosition);
                                           
                if (np != '#')
                {
                   if (np == '$' || np == '*')
                   {
                        if (op != '#' && op != '$' && op != '!')
                        {
                            setChar(op == ' ' ? '$' : op == '.' ? '*' : ' ', otherPosition);
                            setChar(np == '$' ? '@' : np == '*' ? '!' : '@', nextPosition);
                            setChar(p == '@' ? ' ' :  p == '!' ?  '.' : ' ', position);
                        
                            position = nextPosition;
                        }
                   } else {
                        setChar(np == ' ' ? '@' : np == '.' ? '!' : ' ' , nextPosition);
                        setChar(p == '@' ? ' ' :  p == '!' ?  '.' : ' ', position);

                       position = nextPosition;                                           
                   }
                }                
            }
            
            function dec(pkdLevel, width, length)
            {
                var unpkdLevel = new Array(width, length);
                var x = 0;
                var dx = 0, dy = 0;

                for (var b = 0; b < pkdLevel.length; b++)
                {
                    x = parseInt(pkdLevel.charAt(b), 10);
            
                    if (x > 1 && x < 10)
                    {
                        b++;
                        
                        for (var y=1; y <= x; y++)
                        {
                            unpkdLevel[dy][dx] = pkdLevel.charAt(b);
                        }
                    } else {
                        unpkdLevel[dy][dx] = pkdLevel.charAt(b);
                    }
                }

                return unpkdLevel;
            }
                        
            function decompress(pkdLevel)
            {
                var unpkdLevel = "", x;
                
                for (var b=0; b<=(pkdLevel.length); b++)
                {
                    x = parseInt(pkdLevel.charAt(b), 10);
            
                    if (x > 1 && x < 10)
                    {
                        b++;
                        for (var y=1; y<=x; y++)
                        {
                            unpkdLevel+=pkdLevel.charAt(b);
                        }
                    } else {
                        unpkdLevel+=pkdLevel.charAt(b);
                    }
                }
                return unpkdLevel;
            }

        
		</SCRIPT>
			
</BODY></HTML>